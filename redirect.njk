---js
{
  pagination: {
    data: "collections.all",
    size: 1,
    alias: "redirect",
    before: function (data) {
      const redirects = [];
      const seen = new Set();

      const addRedirect = (from, to) => {
        if (typeof from !== "string" || from.length === 0) {
          return;
        }

        const normalizedFrom = from.replace(/\/$/, "");

        if (normalizedFrom.length === 0 || seen.has(normalizedFrom)) {
          return;
        }

        seen.add(normalizedFrom);
        redirects.push({ to, from: normalizedFrom });
      };

      data.forEach((page) => {
        if (Array.isArray(page.data.redirect_from)) {
          for (let url of page.data.redirect_from) {
            addRedirect(url, page.url);
          }
        } else if (typeof page.data.redirect_from === 'string') {
          addRedirect(page.data.redirect_from, page.url);
        }

        if (
          typeof page.url === "string" &&
          page.url.startsWith("/our-work/") &&
          page.url !== "/our-work/"
        ) {
          addRedirect(page.url.replace(/^\/our-work/, ""), page.url);
        }
      });

      return redirects;
    },
    addAllPagesToCollections: false,
  },
  permalink: "{{ redirect.from }}/index.html",
  eleventyExcludeFromCollections: true,
}
---
<!DOCTYPE html>
<html lang="en-US">
  <meta charset="utf-8" />
  <title>Redirecting&hellip;</title>
  <link rel="canonical" href="{{ redirect.to | url }}" />
  <script>
    location = '{{ redirect.to | url }}';
  </script>
  <meta http-equiv="refresh" content="0; url={{ redirect.to | url }}" />
  <meta name="robots" content="noindex" />
  <h1>Redirecting&hellip;</h1>
  <a href="{{ redirect.to | url }}">Click here if you are not redirected.</a>
</html>
